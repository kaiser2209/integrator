<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head th:fragment="html_head">

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>[[${pageTitle}]]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/0ebca30b62.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            var numField = 2;
            $("#moreFields").click(function() {
                var inputField = '<div class="row mb-1">' +
                    '<div class="input-group col">' +
                    '<span class="input-group-text text-white bg-secondary">' + numField + '</span>' +
                    '<input class="form-control input-field" type="text" name="fields" />' +
                    '</div>' +
                    '<div class="input-group position-field col">' +
                    '<span class="input-group-text text-white bg-secondary">Pos. Inicial</span>' +
                    '<input class="form-control input-field" type="text" name="posBegin" value="0" />' +
                    '</div>' +
                    '<div class="input-group position-field col">' +
                    '<span class="input-group-text text-white bg-secondary">Pos. Final</span>' +
                    '<input  class="form-control input-field" type="text" name="posEnd" value="0" />' +
                    '</div>' +
                    '</div>';
                $("#campos").append(inputField);
                $(".position-field").toggle(!($("#hasDelimiter").is(":checked")));
                numField++;
            });

            $("#hasDelimiter").click(function() {
                $(".position-field").toggle(!this.checked);
            });

            $("#send").click(function() {
                //$("#teste").load("/config/ws/teste?name=teste");
                $.post("/config/ws/teste", $("#ws-form").serialize()).done(function(data) {
                    //alert(data);
                    //$("#json").replaceWith(data);
                    $("#json-view").replaceWith(data);

                    $("#getJsonFields").off();
                    $("#getJsonFields").click(function() {
                        var jsonValue = $("#json").text();
                        var jsonHeader = $("#json-header").text();
                        var url = $("#ws_path").val();
                        var method = $("#method").val();
                        $.post("/config/ws/fields", { json: jsonValue, header:  jsonHeader } ).done(function(data) {
                            $("#json-fields").replaceWith(data);
                            $("#url").val(url);
                            $("#method-selected").val(method);

                            $("#save-config").off();
                            $("#save-config").click(function() {
                                $.post("/config/ws/save", $("#fields-form").serialize()).done(function(data) {
                                    alert(data);
                                });
                            });

                            $(".chk-enable").off();
                            $(".chk-enable").click(function() {
                                $(this).parent().children(".hidden-enable").val(this.checked);
                            });
                        });
                    });
                });
            });

            $("#btn-new-key").click(function() {
                var newLine = '<tr>' +
                    '<th><input type="text" class="form-control border-0" name="key" /></th>' +
                    '<th><input type="text" class="form-control border-0" name="value" /></th>' +
                    '</tr>';
                $("#table-header-keys tr:last").after(newLine);
            });


        });
    </script>
</head>
<body>
    <div th:fragment="menu">
        <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link fas fa-home fa-2x icon-silver" href="#"></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/config/file">Arquivo</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/config/ws">Web Service</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Banco de Dados</a>
                </li>
            </ul>
        </nav>
    </div>
    <div th:fragment="html_foot" class="text-center">
        <p>Integrador Mobiplus - Copyright &copy;</p>
    </div>
    <div th:fragment="bootstrap-js">

        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js" integrity="sha384-eMNCOe7tC1doHpGoWe/6oMVemdAVTMs2xqW4mwXrXsW0L84Iytr2wi5v2QjrP/xp" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js" integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/" crossorigin="anonymous"></script>
    </div>
</body>
</html>